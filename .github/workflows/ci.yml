name: ci

on: [ push, pull_request ]

jobs:
  inspection:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Set up Python 3.11
        uses: actions/setup-python@v2
        with:
          python-version: 3.11
      - run: pip install flake8
      - run: pip install mypy
      - run: flake8 sin.py sinner
      - run: mypy --config-file mypy.ini sin.py sinner
  tests:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Set up ffmpeg
        uses: FedericoCarboni/setup-ffmpeg@v2
      - name: Set up Python 3.11
        uses: actions/setup-python@v2
        with:
          python-version: 3.11
      - run: df -h
      - run: pip install -r requirements-ci.txt
      - run: |
          export DISPLAY=:1:0
          Xvfb :1 -screen 0 1600x1200x16 &
      - run: pytest -m "not skip"

